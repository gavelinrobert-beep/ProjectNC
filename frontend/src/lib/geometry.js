export function pointInPoly([lat,lon],poly){let inside=false;for(let i=0,j=poly.length-1;i<poly.length;j=i++){const xi=poly[i][0],yi=poly[i][1];const xj=poly[j][0],yj=poly[j][1];const intersect=((yi>lon)!=(yj>lon))&&(lat<(xj-xi)*(lon-yi)/(yj-yi+1e-12)+xi);if(intersect)inside=!inside}return inside}
export function distPointToSegMeters([x,y],[x1,y1],[x2,y2]){const kx=111000;const ky=111000*Math.cos((x*Math.PI)/180);const A=[0,0];const B=[(x2-x1)*kx,(y2-y1)*ky];const P=[(x-x1)*kx,(y-y1)*ky];const dot=(u,v)=>u[0]*v[0]+u[1]*v[1];const norm2=(u)=>u[0]*u[0]+u[1]*u[1];const t=Math.max(0,Math.min(1,norm2(B)===0?0:dot(P,B)/norm2(B)));const proj=[A[0]+t*B[0],A[1]+t*B[1]];const dx=P[0]-proj[0],dy=P[1]-proj[1];return Math.sqrt(dx*dx+dy*dy)}
export function minDistToPolyMeters([lat,lon],poly){if(!Array.isArray(poly)||poly.length<2)return Infinity;let min=Infinity;for(let i=0;i<poly.length;i++){const a=poly[i],b=poly[(i+1)%poly.length];const d=distPointToSegMeters([lat,lon],a,b);if(d<min)min=d}return min}
